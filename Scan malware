import os
import hashlib
import threading
import tkinter as tk
from tkinter import filedialog, scrolledtext

# ---------------- CONFIG ---------------- #

SUSPICIOUS_EXTENSIONS = [".exe", ".bat", ".vbs", ".scr", ".ps1"]
KNOWN_MALWARE_HASHES = {
    # EXEMPLES (hashs fictifs)
    "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
}

# ---------------- CORE ---------------- #

def sha256_file(path):
    try:
        with open(path, "rb") as f:
            h = hashlib.sha256()
            for chunk in iter(lambda: f.read(4096), b""):
                h.update(chunk)
        return h.hexdigest()
    except:
        return None

def analyze_file(path, log):
    log(f"üîç Scanning: {path}")

    ext = os.path.splitext(path)[1].lower()
    if ext in SUSPICIOUS_EXTENSIONS:
        log(f"‚ö†Ô∏è Suspicious extension detected: {path}")

    file_hash = sha256_file(path)
    if file_hash in KNOWN_MALWARE_HASHES:
        log(f"üö® MALWARE HASH DETECTED: {path}")

def scan_directory(directory, log):
    for root, _, files in os.walk(directory):
        for file in files:
            full_path = os.path.join(root, file)
            analyze_file(full_path, log)
    log("‚úÖ Scan completed.")

# ---------------- UI ---------------- #

class CyberScannerUI:
    def __init__(self, root):
        self.root = root
        root.title("CYBER MALWARE SCANNER")
        root.geometry("800x500")
        root.configure(bg="#0b0f14")

        title = tk.Label(
            root,
            text="üõ° CYBER MALWARE SCANNER",
            fg="#00ffcc",
            bg="#0b0f14",
            font=("Consolas", 18, "bold")
        )
        title.pack(pady=10)

        self.log_area = scrolledtext.ScrolledText(
            root,
            bg="#020409",
            fg="#00ff00",
            insertbackground="#00ff00",
            font=("Consolas", 10)
        )
        self.log_area.pack(expand=True, fill="both", padx=10, pady=10)

        btn = tk.Button(
            root,
            text="‚ñ∂ START SCAN",
            bg="#111827",
            fg="#00ffcc",
            font=("Consolas", 12),
            command=self.start_scan
        )
        btn.pack(pady=10)

    def log(self, message):
        self.log_area.insert(tk.END, message + "\n")
        self.log_area.see(tk.END)

    def start_scan(self):
        folder = filedialog.askdirectory()
        if not folder:
            return

        self.log(f"üóÇ Selected directory: {folder}")
        thread = threading.Thread(
            target=scan_directory,
            args=(folder, self.log),
            daemon=True
        )
        thread.start()

# ---------------- RUN ---------------- #

if __name__ == "__main__":
    root = tk.Tk()
    app = CyberScannerUI(root)
    root.mainloop()
